
\begin{sagesilent}
f(x) = (x^2-5*x+6)/(x-4)
print "ASÍNTOTAS"
print "Vertical"

print "Posibles puntos de asíntota: los que anulan el denominador. Resolvemos \[",latex(f.denominator()(x)),"= 0\]"
    
    
    
print "\n"
print "Horizontal u Oblícua"
print "Calculamos \[\lim_{x\mapsto \pm\infty}",latex(f(x)),"\]"

for infty in [Infinity, -Infinity]: # Calculamos en los 2 extremos:
    print "En ",latex(infty),":"
    ld=limit(f, x=infty)

    print "\[\lim_{x\mapsto ",latex(infty),"}",f(x)," = ",ld(x),"\]"

    # Distinguimos si hay horizontal u oblicua en función del resultado del límite

    if (not (abs(ld(x)) == Infinity)): # HORIZONTAL
  
        print "    En $",latex(infty),"$ f(x) tiene una asíntota horizontal en y =",ld(x)

    else: # OBLICUA

        print "    Podemos tener una asíntota oblícua. Para comprobarlo calculamos: "
        print "    \[m=\lim_{x\mapsto ",latex(infty),"} \\frac{",latex(f(x)),"}{x}=\lim_{x\mapsto ",latex(infty),"} ",latex(f(x)/x),"\]"
        _m=limit(f/x,x=infty)
        m=_m(x)
        if (abs(m) != Infinity):
            print "        En este caso, ese límite tenemos m=",m," por lo que sí hay asíntota oblícua. Calculamos n:"
            print "    \[n=\lim_{x\mapsto ",latex(infty),"}",latex(f(x)),"- ",m,"x} = \lim_{x\mapsto ",latex(infty),"}",latex(f(x)-m*x),"\]"
            _n = limit(f-m*x,x=infty)
            n=_n(x)
            y=m*x+n
            print "        En $",latex(infty),"$f(x) tiene una asíntota oblícua en y=",y
        else:
            print "        En este caso, ese límite tenemos m=",m," por lo que no hay asíntota oblícua."

    
    


print "\n\n"
print "SIMETRÍA"
print "Calculamos f(-x) = ",f(-x),". ¿Es igual a f(x) o a -f(x)?"
if (f(x) == f(-x)):
    print "Sí, a f(x), por lo que la función es par"
elif (f(x) == - f(-x)):
    print "Sí, a -f(x) por lo que la función es impar"
else:
    print "No, por lo que la función no tiene simetría respecto del eje Y."
print "\n\n"



print "Puntos de corte eje X: resolvemos f(x) = 0 cuya solución es: "
i=0
for r in f.roots():
    print "x_",i," = ",r[0]
    i+=1
print "Punto de corte eje Y: resolvemos f(0)=",f(0)
print "\n\n"
print "MONOTONÍA"

print "Calculamos la derivada de la función: \[f'(x) = ",latex(diff(f,x,1)(x)),"\]"

print "Para calcular los puntos críticos, resolvemos f'(x) = 0 cuyas soluciones son: "
i=0
for r in solve(diff(f(x))==0,x,solution_dict=True):
    print "x_",i," = ",latex(r[x])
    i+=1
   
ptscrit = flatten([den0,solve(diff(f(x))==0,x,solution_dict=True)])
recta=[-Infinity]
print "\n Por lo tanto, los puntos críticos son: "
i=0
for p in ptscrit:
    print "x_",i,"=",latex(p[x])
    recta.append(p[x])
    i+=1
print "(OJO: Se deben incluir los puntos de discontinuidad)"
recta.append(+Infinity)
recta=sorted(recta)
print "\n\nEstudiamos la monotonía. Para ello tomamos los siguientes intervalos: "
for i in xrange(len(recta)-1):
    print "(",recta[i],",",recta[i+1],")"

def random_between(j,k):
    
    if (j==-Infinity):
        j2=-9999
    else:
        j2=j+1 # El +1 es para evitar divisiones por 0 que podrían darse.
        
    if (k==Infinity):
        k2=9999
    else:        
        
        k2=k-1 # El +1 es para evitar divisiones por 0 que podrían darse
    return int(random()*(k2-j2+1))+j2

   
g=diff(f,x,1)
print "Y estudiamos la monotonía el signo de la derivada en esos intervalos:"
for i in xrange(len(recta)-1):
    rval=random_between(recta[i],recta[i+1])
    print "(",recta[i],",",recta[i+1],"): Tomamos, por ejemplo, f'(",rval,") y miramos su signo:", "Positivo, por lo que la función \\textbf{crece} en este intervalo" if sign(g(rval))==1 else "Negativo, por lo que la función \\textbf{decrece} en este intervalo"
\end{sagesilent}
